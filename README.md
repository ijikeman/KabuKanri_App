# 要件定義書 - Kotlin Spring Boot 株価分析サイト開発

## 1. 目的

本プロジェクトは、Kotlin Spring Bootフレームワークの機能や開発実装を学習することを目的とし、
マルチモジュールプロジェクト構造を使用した認証機能付き株価分析サイトを段階的に実装することで実践的なスキルを習得する。

## 2. 機能要件

### 2.1 必須機能

- [ ] **ユーザー認証機能**
  - ログインフォーム（ユーザー名/パスワード）
  - ユーザー登録機能
  - セッション管理
  - ログアウト機能

- [ ] **所持株式一覧と損益管理機能**
  - 所持株式データの一覧表示
    - 証券コード
    - 取得株価
    - 単元数
    - 現在の株価(自動更新)
    - 配当金(自動更新)
    - 優待(実質価値)
    - 配当利回り率(取得株価に対する)
    - 配当利回り率(現在の株価に対する)
    - 優待利回り率(取得株価に対する)
    - 優待利回り率(現在の株価に対する)
    - 年間利回り率(取得株価に対する)
    - 年間利回り率(現在の株価に対する)
    - 購入金額(取得株価*単元数)
    - 資産額(現在の株価*単元数)
    - 総配当金金額
    - 総優待金額
    - 株式損益金額
    - トータル損益金額(株式損益+総配当金、総優待金)
    - 利益率
    - 取得日
    - 売却日
    - 株式業種名 資産分散円グラフ作成のため
    - 次回決算発表日(自動更新)
  - データの自動更新機能
    - 売却日が入っていないもの全部
    - 各銘柄単位(データ取得サイト負荷軽減のため)
  - データ取得先
    - 株価, 配当金: yahooファイナンス
    - 次回決算発表日: moomoo証券

- [ ] **株価データ表示機能**
  - 株価データの取得・表示
  - 銘柄検索機能
  - 株価チャート表示（基本的なグラフ）
  - 過去データの表示

- [ ] **株価分析機能**
  - 移動平均線の計算・表示
  - 価格変動率の計算
  - 基本的な技術指標（RSI、MACD等）

- [ ] **データ管理機能**
  - ユーザー情報の保存
  - お気に入り銘柄の登録・管理
  - 株価データのキャッシュ機能
  - 所持株式データ登録・管理

- [ ] **マルチモジュール構造**
  - Core Module（共通機能）
  - Auth Module（認証機能）
  - Stock Module（株価機能）
  - Web Module（Webインターフェース）

### 2.2 オプション機能

- [ ] ポートフォリオ管理機能
- [ ] アラート機能（価格通知）
- [ ] 高度な技術分析ツール
- [ ] RESTful API の提供
- [ ] リアルタイム株価更新

## 3. 非機能要件

### 3.1 パフォーマンス

- ページ読み込み時間：3秒以内
- データベースクエリ実行時間：1秒以内
- 同時ユーザー数：最大100名

### 3.2 セキュリティ

- パスワードのハッシュ化（BCrypt使用）
- SQL インジェクション対策
- XSS攻撃対策
- CSRF保護の実装
- セッション管理のセキュリティ

### 3.3 保守性

- クリーンなコード構造の維持
- 適切なコメントと文書化
- テストカバレッジ70%以上
- モジュール間の疎結合設計

### 3.4 互換性

- Java 17以上対応
- Kotlin 2.2以上対応
- Spring Boot 3.5対応
- 主要ブラウザ対応（Chrome、Firefox、Safari、Edge）

## 4. 制約事項

### 4.1 技術的制約

- **開発言語**: Kotlin
- **フレームワーク**: Spring Boot 3.5
- **データベース**: H2（開発用）、MySQL（本番想定）
- **ビルドツール**: Gradle
- **テンプレートエンジン**: Thymeleaf
- **株価データAPI**: Yahoo Finance API または Alpha Vantage API
- **プロジェクト構造**: マルチモジュール必須

### 4.2 ビジネス制約

- 学習目的のため、商用利用は想定しない
- 開発期間：段階的実装により柔軟に対応
- リアルタイム株価データは無料APIの制限内で利用

## 5. 成功基準

### 5.1 完了の定義

- [ ] 認証機能が正常に動作する
- [ ] 株価データの取得・表示ができる
- [ ] 基本的な株価分析機能が動作する
- [ ] マルチモジュール構造が適切に実装されている
- [ ] セキュリティ要件が満たされている
- [ ] 単体テストが実装されている
- [ ] README.mdに実装内容が文書化されている

### 5.2 受け入れテスト

- ユーザーがログイン・ログアウトできる
- 株価データの検索・表示ができる
- 移動平均線などの基本分析ができる
- お気に入り銘柄の登録・削除ができる
- エラーハンドリングが適切に動作する

## 6. 想定されるリスク

### 6.1 技術的リスク
- **株価API制限**: 無料APIの呼び出し制限に引っかかる可能性
  - 対策: キャッシュ機能の実装、データ取得頻度の調整

- **マルチモジュール設計の複雑性**: 初学者には構造が複雑
  - 対策: 段階的な実装、詳細な文書化

- **セキュリティ設定**: Spring Securityの設定が複雑
  - 対策: 基本的な設定から段階的に拡張

### 6.2 学習リスク
- **Kotlin文法の理解不足**: Javaとの違いによる混乱
  - 対策: 段階的な学習、豊富なコメント

## 7. 開発段階とタスク一覧

### Phase 1: プロジェクト基盤構築
- [ ] マルチモジュールプロジェクト構造の作成
- [ ] 基本的な依存関係の設定
- [ ] データベース設定（H2）
- [ ] 基本的な設定ファイルの作成

### Phase 2: 認証機能実装
- [ ] User エンティティの作成
- [ ] Spring Security設定
- [ ] ログイン・ログアウト機能
- [ ] ユーザー登録機能
- [ ] 認証のテスト実装

### Phase 3: 株価データ機能実装
- [ ] 株価データ取得API連携
- [ ] Stock エンティティの作成
- [ ] 株価データ表示画面
- [ ] 銘柄検索機能
- [ ] データキャッシュ機能

### Phase 4: 分析機能実装
- [ ] 移動平均線計算機能
- [ ] 基本的な技術指標実装
- [ ] チャート表示機能
- [ ] お気に入り銘柄管理

### Phase 5: テスト・最適化
- [ ] 単体テスト実装
- [ ] 統合テスト実装
- [ ] パフォーマンス最適化
- [ ] セキュリティテスト
- [ ] 文書化完成

## 8. 今後の検討事項

- フロントエンド技術の選択（Thymeleaf vs React/Vue.js）
- キャッシュ戦略の詳細設計
- デプロイメント戦略（Docker化等）
- モニタリング・ログ戦略
- 本番環境でのデータベース設計

## 9. 学習目標

### 9.1 Kotlin関連
- Kotlinの基本文法と慣用句
- Java互換性の理解
- データクラス、拡張関数の活用

### 9.2 Spring Boot関連
- Dependency Injection の理解
- Spring MVC パターンの実装
- Spring Data JPA の使用
- Spring Security の設定と使用
- テスト戦略（@SpringBootTest等）

### 9.3 アーキテクチャ関連
- マルチモジュール設計の理解
- レイヤードアーキテクチャの実装
- 疎結合設計の実践

## 10. 参考資料

- Spring Boot公式ドキュメント
- Kotlin公式ドキュメント
- Spring Security リファレンス
- 株価API ドキュメント

---

**プロジェクト開始日**: 2025年7月26日  
**想定完了日**: 段階的実装により柔軟に設定  
**作成者**: [学習者名]  
**レビュー**: 各フェーズ完了時
